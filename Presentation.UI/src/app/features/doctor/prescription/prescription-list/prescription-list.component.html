<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">My Prescriptions</h1>
        <p class="text-gray-600 mt-2">View and manage your prescriptions</p>
      </div>
      <a routerLink="/doctor/prescriptions/new"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
        + New Prescription
      </a>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <!-- Search -->
      <div class="md:col-span-2">
        <input type="text" [value]="searchQuery()" (input)="onSearch($any($event.target).value)"
          placeholder="Search by diagnosis, patient..."
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
      </div>

      <!-- Status Filter -->
      <div>
        <select [value]="selectedStatus()" (change)="onStatusFilterChange($any($event.target).value)"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <option value="">All Status</option>
          @for (status of prescriptionStatuses; track status) {
          <option [value]="status">{{ status }}</option>
          }
        </select>
      </div>

      <!-- Date Range -->
      <div class="flex gap-2">
        <input type="date" [value]="dateFrom()" (change)="onDateFromChange($any($event.target).value)"
          placeholder="From"
          class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
        <input type="date" [value]="dateTo()" (change)="onDateToChange($any($event.target).value)" placeholder="To"
          class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
      </div>
    </div>

    <!-- Clear Filters -->
    <div class="mt-4">
      <button (click)="clearFilters()" class="text-sm text-gray-600 hover:text-gray-800">
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-lg shadow">
    <app-dynamic-table [columns]="columns" [data]="getTableData()" [loading]="loading()" [pageSize]="10"
      (rowClick)="onRowClick($event)">
      <!-- Status Badge Template -->
      <ng-template #statusTemplate let-row>
        <span [class]="'inline-flex px-3 py-1 rounded-full text-sm font-medium ' + getStatusBadgeClass(row.status)">
          {{ row.status }}
        </span>
      </ng-template>

      <!-- Actions Template -->
      <ng-template #actionsTemplate let-row>
        <div class="flex items-center gap-2">
          <button (click)="onView(row._prescription); $event.stopPropagation()"
            class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200 transition-colors">
            View
          </button>
          <button (click)="onEdit(row._prescription); $event.stopPropagation()"
            class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 transition-colors">
            Edit
          </button>
          <button (click)="onDelete(row._prescription); $event.stopPropagation()"
            class="px-3 py-1 bg-red-100 text-red-700 rounded text-sm hover:bg-red-200 transition-colors">
            Delete
          </button>
        </div>
      </ng-template>
    </app-dynamic-table>
  </div>
</div>