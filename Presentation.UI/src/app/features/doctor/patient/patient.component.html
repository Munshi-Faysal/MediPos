<div class="container mx-auto px-6 py-8">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Patients</h1>
      <p class="text-gray-500 mt-1">Manage your patient records and history</p>
    </div>

    <!-- Action Buttons -->
    <div class="mt-4 md:mt-0 flex gap-3">
      @if (currentView !== 'list') {
      <button (click)="showList()"
        class="bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-2.5 px-6 rounded-lg transition-colors duration-200 shadow-sm flex items-center gap-2">
        Cancel
      </button>
      }
      @if (currentView === 'list') {
      <button (click)="showCreate()"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 px-6 rounded-lg transition-colors duration-200 shadow-sm flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Add New Patient
      </button>
      }
      @if (currentView === 'create') {
      <button (click)="createPatient()" [disabled]="isLoading"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2.5 px-6 rounded-lg transition-colors duration-200 shadow-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
        <svg *ngIf="isLoading" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg"
          fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
        {{ isLoading ? 'Processing...' : (isEditing ? 'Update Patient' : 'Save Patient') }}
      </button>
      }
    </div>
  </div>

  <!-- LIST VIEW -->
  @if (currentView === 'list') {
  <!-- Filters & Search -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 mb-8">
    <div class="relative max-w-md">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="filterPatients()"
        class="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 sm:text-sm transition duration-150 ease-in-out"
        placeholder="Search patients by name, email, or phone..." />
    </div>
  </div>
  <!-- Patient List -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Patient</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Contact</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Age / Gender</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Blood Group</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Last Visit</th>
            <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Status</th>
            <th scope="col" class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (patient of filteredPatients; track patient) {
          <tr (click)="showDetails(patient)"
            class="hover:bg-gray-50 transition-colors duration-150 ease-in-out cursor-pointer">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <img class="h-10 w-10 rounded-full object-cover border border-gray-200" [src]="patient.image" alt="">
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">{{ patient.name }}</div>
                  <div class="text-sm text-gray-500">{{ patient.email }}</div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ patient.phone }}</div>
              <div class="text-sm text-gray-500">{{ patient.address | slice:0:20 }}...</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">{{ patient.age }} Years</div>
              <div class="text-sm text-gray-500">{{ patient.gender }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-red-100 text-red-700 text-xs font-bold">
                {{ patient.bloodGroup }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ patient.lastVisit | date:'mediumDate' }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" [ngClass]="{
                    'bg-green-100 text-green-800': patient.status === 'Active',
                    'bg-gray-100 text-gray-800': patient.status === 'Inactive'
                  }">
                {{ patient.status }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <div class="flex items-center justify-end gap-2">
                <button (click)="$event.stopPropagation(); showDetails(patient)"
                  class="text-indigo-600 hover:text-indigo-900 transition-colors duration-200 p-1.5 rounded-full hover:bg-indigo-50"
                  title="View Details">
                  View
                </button>
                <button (click)="$event.stopPropagation(); showEdit(patient)"
                  class="text-blue-600 hover:text-blue-900 transition-colors duration-200 p-1.5 rounded-full hover:bg-blue-50"
                  title="Edit Patient">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                </button>
                <button (click)="$event.stopPropagation(); deletePatient(patient)"
                  class="text-red-500 hover:text-red-700 transition-colors duration-200 p-1.5 rounded-full hover:bg-red-50"
                  title="Delete Patient">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    <!-- Empty State -->
    @if (filteredPatients.length === 0) {
    <div class="text-center py-12">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">No patients found</h3>
      <p class="mt-1 text-sm text-gray-500">Try adjusting your search terms or add a new patient.</p>
    </div>
    }
  </div>
  }

  <!-- CREATE PATIENT FORM -->
  @if (currentView === 'create') {
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 md:p-8 max-w-4xl mx-auto">
    <h2 class="text-xl font-semibold text-gray-900 mb-6 border-b pb-4">
      {{ isEditing ? 'Edit Patient Details' : 'New Patient Registration' }}
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Personal Info -->
      <div class="space-y-4">
        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3">Personal Information</h3>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
          <input [(ngModel)]="newPatient.name" type="text"
            class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"
            placeholder="e.g. John Doe">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Age</label>
            <input [(ngModel)]="newPatient.age" type="number"
              class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"
              placeholder="e.g. 35">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
            <select [(ngModel)]="newPatient.gender"
              class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Blood Group</label>
          <select [(ngModel)]="newPatient.bloodGroup"
            class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border">
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
          </select>
        </div>
      </div>
      <!-- Contact Info -->
      <div class="space-y-4">
        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3">Contact Information</h3>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
          <input [(ngModel)]="newPatient.phone" type="text"
            class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"
            placeholder="e.g. +1 (555) 000-0000">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input [(ngModel)]="newPatient.email" type="email"
            class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"
            placeholder="e.g. john@example.com">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
          <textarea [(ngModel)]="newPatient.address" rows="3"
            class="block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2.5 border"
            placeholder="Full address..."></textarea>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- PATIENT DETAILS VIEW -->
  @if (currentView === 'view' && selectedPatient) {
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column: Patient Profile Card -->
    <div class="lg:col-span-1 space-y-6">
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="bg-indigo-600 h-24"></div>
        <div class="px-6 pb-6 text-center relative">
          <div class="relative -top-12 inline-block">
            <img [src]="selectedPatient.image"
              class="h-24 w-24 rounded-full border-4 border-white shadow-md object-cover" alt="">
          </div>
          <h2 class="text-xl font-bold text-gray-900">{{ selectedPatient.name }}</h2>
          <p class="text-sm text-gray-500">{{ selectedPatient.email }}</p>
          <div class="mt-4 flex justify-center gap-2">
            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full" [ngClass]="{
                  'bg-green-100 text-green-800': selectedPatient.status === 'Active',
                  'bg-gray-100 text-gray-800': selectedPatient.status === 'Inactive'
                }">
              {{ selectedPatient.status }}
            </span>
            <span
              class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800">
              {{ selectedPatient.gender }}
            </span>
          </div>
          <div class="mt-6 border-t pt-6 grid grid-cols-2 gap-4 text-left">
            <div>
              <p class="text-xs text-gray-500">Age</p>
              <p class="font-medium text-gray-900">{{ selectedPatient.age }} Years</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Blood Group</p>
              <p class="font-medium text-gray-900">{{ selectedPatient.bloodGroup }}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Phone</p>
              <p class="font-medium text-gray-900">{{ selectedPatient.phone }}</p>
            </div>
            <div>
              <p class="text-xs text-gray-500">Last Visit</p>
              <p class="font-medium text-gray-900">{{ selectedPatient.lastVisit | date:'shortDate' }}</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Latest Vitals (Mock) -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <h3 class="text-base font-semibold text-gray-900 mb-4">Latest Vitals</h3>
        <div class="space-y-4">
          <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
            <span class="text-sm text-gray-600">Weight</span>
            <span class="font-bold text-gray-900">{{ selectedPatient.weight || 'N/A' }}</span>
          </div>
          <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
            <span class="text-sm text-gray-600">Height</span>
            <span class="font-bold text-gray-900">{{ selectedPatient.height || 'N/A' }}</span>
          </div>
          <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
            <span class="text-sm text-gray-600">Blood Pressure</span>
            <span class="font-bold text-gray-900">{{ selectedPatient.bp || 'N/A' }}</span>
          </div>
        </div>
      </div>
    </div>
    <!-- Right Column: History & Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
          <p class="text-xs font-medium text-gray-500 uppercase">Total Visits</p>
          <p class="mt-2 text-2xl font-bold text-gray-900">{{ selectedPatient.medicalHistory?.length || 0 }}</p>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
          <p class="text-xs font-medium text-gray-500 uppercase">Prescriptions</p>
          <p class="mt-2 text-2xl font-bold text-gray-900">{{ selectedPatient.medicalHistory?.length || 0 }}</p>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
          <p class="text-xs font-medium text-gray-500 uppercase">Next Appointment</p>
          <p class="mt-2 text-lg font-bold text-indigo-600">--</p>
        </div>
      </div>
      <!-- History Tab -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="border-b px-6 py-4 flex items-center justify-between bg-gray-50">
          <h3 class="text-base font-semibold text-gray-900">Visit History</h3>
        </div>
        <div class="p-0">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diagnosis
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Doctor</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              @for (visit of selectedPatient.medicalHistory; track visit) {
              <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ visit.date | date:'mediumDate' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ visit.diagnosis }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ visit.doctor }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    {{ visit.status }}
                  </span>
                </td>
              </tr>
              }
              @if (!selectedPatient.medicalHistory?.length) {
              <tr>
                <td colspan="4" class="px-6 py-8 text-center text-sm text-gray-500">No medical history found.</td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  }
</div>