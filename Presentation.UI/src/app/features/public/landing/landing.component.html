<div
  class="min-h-screen bg-background bg-gradient-to-b from-surface to-background text-on-background transition-colors duration-300">
  <!-- Navigation Bar -->
  <nav class="bg-surface border-b border-border sticky top-0 z-50 transition-colors">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center">
          <span class="text-2xl font-bold text-primary-600">MediPos</span>
          <span class="ml-2 text-sm text-on-surface-variant">Prescription Management</span>
        </div>

        <!-- Login Button -->
        <a routerLink="/auth/login"
          class="px-6 py-2.5 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-all shadow-soft hover:shadow-medium">
          Login
        </a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="text-center mb-16">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-on-surface mb-4">
        Prescription Management System
      </h1>
      <p class="text-xl text-on-surface-variant max-w-3xl mx-auto">
        Streamline your healthcare practice with our comprehensive prescription management solution.
        Choose the perfect plan for your needs.
      </p>
    </div>

    <!-- Packages Section -->
    @if (packages.length > 0) {
      <div class="mb-16">
        <h2 class="text-3xl font-bold text-center text-on-surface mb-8">Choose Your Package</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
          @for (pkg of packages; track pkg) {
            <div
              [ngClass]="pkg.isPopular ? 'border-primary-500 ring-2 ring-primary-500/20' : 'border-border'"
              class="bg-surface rounded-xl shadow-medium hover:shadow-strong transition-all duration-300 border-2">
              <!-- Popular Badge -->
              @if (pkg.isPopular) {
                <div class="relative">
                  <div
                    class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-primary-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-md">
                    Most Popular
                  </div>
                </div>
              }
              <div class="p-6">
                <h3 class="text-2xl font-bold text-on-surface mb-2">{{ pkg.name }}</h3>
                <p class="text-on-surface-variant mb-4 text-sm">{{ pkg.description }}</p>
                <div class="mb-6">
                  @if (pkg.price === 0) {
                    <span class="text-4xl font-bold text-primary-600">Free</span>
                  }
                  @if (pkg.price > 0) {
                    <span class="text-4xl font-bold text-primary-600">${{ pkg.price }}</span>
                  }
                  <span class="text-on-surface-variant">/{{ pkg.duration }}</span>
                </div>
                <ul class="space-y-3 mb-6">
                  @for (feature of pkg.featureList; track feature) {
                    <li class="flex items-start">
                      <svg class="w-5 h-5 text-success-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                      </svg>
                      <span class="text-on-surface">{{ feature }}</span>
                    </li>
                  }
                </ul>
                <button (click)="selectPackage(pkg)" class="w-full py-3 px-6 rounded-lg font-semibold transition-all"
                  [class.bg-primary-600]="pkg.isPopular" [class.text-white]="pkg.isPopular"
                  [class.hover:bg-primary-700]="pkg.isPopular" [class.bg-secondary-100]="!pkg.isPopular"
                  [class.text-secondary-900]="!pkg.isPopular" [class.hover:bg-secondary-200]="!pkg.isPopular"
                  [class.dark:bg-secondary-800]="!pkg.isPopular" [class.dark:text-secondary-100]="!pkg.isPopular">
                  Select Plan
                </button>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Payment Form Section -->
    @if (showPaymentForm && !showWelcomeMessage) {
      <div id="payment-section" class="max-w-2xl mx-auto">
        <div class="bg-surface rounded-xl shadow-strong p-8 border border-border">
          <!-- Selected Package Summary -->
          @if (selectedPackage) {
            <div class="mb-8 p-6 bg-primary-500/5 rounded-lg border border-primary-500/20">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <h3 class="text-xl font-bold text-on-surface">{{ selectedPackage.name }}</h3>
                  <p class="text-on-surface-variant text-sm mt-1">{{ selectedPackage.description }}</p>
                </div>
                <button (click)="changePackage()"
                  class="text-primary-600 hover:text-primary-700 text-sm font-medium transition-colors">
                  Change Package
                </button>
              </div>
              <div class="flex justify-between items-center pt-4 border-t border-border">
                <div>
                  @if (selectedPackage.price > 0) {
                    <span class="text-on-surface font-medium">Monthly Price:</span>
                  }
                  @if (selectedPackage.price === 0) {
                    <span class="text-on-surface font-medium">Trial Period:</span>
                  }
                  @if (selectedPackage.price > 0) {
                    <p class="text-xs text-on-surface-variant mt-1">Payment is optional -
                    you can pay later</p>
                  }
                  @if (selectedPackage.price === 0) {
                    <p class="text-xs text-on-surface-variant mt-1">No payment required
                    for free trial</p>
                  }
                </div>
                @if (selectedPackage.price === 0) {
                  <span class="text-2xl font-bold text-success-600">Free</span>
                }
                @if (selectedPackage.price > 0) {
                  <span class="text-2xl font-bold text-primary-600">${{
                  selectedPackage.price }}</span>
                }
              </div>
            </div>
          }
          <h2 class="text-2xl font-bold text-on-surface mb-6 border-b border-border pb-2">Payment Information</h2>
          <form [formGroup]="paymentForm" (ngSubmit)="onSubmitPayment()">
            <!-- Organization Details -->
            <div class="mb-8">
              <h3 class="text-sm font-bold text-primary-500 uppercase tracking-wider mb-4">Organization Details</h3>
              <div class="space-y-4">
                <div>
                  <label class="form-label">
                    Organization Name <span class="text-error-500">*</span>
                  </label>
                  <input type="text" formControlName="organizationName" class="form-input"
                    [class.border-error-500]="isFieldInvalid('organizationName')"
                    placeholder="Enter your organization name" />
                    @if (isFieldInvalid('organizationName')) {
                      <p class="form-error">
                        {{ getErrorMessage('organizationName') }}
                      </p>
                    }
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="form-label">
                        Email <span class="text-error-500">*</span>
                      </label>
                      <input type="email" formControlName="email" class="form-input"
                        [class.border-error-500]="isFieldInvalid('email')" placeholder="your@email.com" />
                        @if (isFieldInvalid('email')) {
                          <p class="form-error">
                            {{ getErrorMessage('email') }}
                          </p>
                        }
                      </div>
                      <div>
                        <label class="form-label">
                          Phone Number <span class="text-error-500">*</span>
                        </label>
                        <input type="tel" formControlName="phone" class="form-input"
                          [class.border-error-500]="isFieldInvalid('phone')" placeholder="+1 (555) 123-4567" />
                          @if (isFieldInvalid('phone')) {
                            <p class="form-error">
                              {{ getErrorMessage('phone') }}
                            </p>
                          }
                        </div>
                      </div>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label class="form-label">
                            Password <span class="text-error-500">*</span>
                          </label>
                          <input type="password" formControlName="password" class="form-input"
                            [class.border-error-500]="isFieldInvalid('password')" placeholder="Enter password" />
                            @if (isFieldInvalid('password')) {
                              <p class="form-error">
                                {{ getErrorMessage('password') }}
                              </p>
                            }
                            <p class="text-[10px] text-on-surface-variant mt-1">
                              Must contain: uppercase, lowercase, number, and special character
                            </p>
                          </div>
                          <div>
                            <label class="form-label">
                              Confirm Password <span class="text-error-500">*</span>
                            </label>
                            <input type="password" formControlName="confirmPassword" class="form-input"
                              [class.border-error-500]="isFieldInvalid('confirmPassword')" placeholder="Confirm password" />
                              @if (isFieldInvalid('confirmPassword')) {
                                <p class="form-error">
                                  {{ getErrorMessage('confirmPassword') }}
                                </p>
                              }
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Payment Details -->
                      <div class="mb-8 p-6 bg-surface-variant/50 rounded-xl border border-border">
                        <div class="flex items-center justify-between mb-4">
                          <h3 class="text-sm font-bold text-primary-500 uppercase tracking-wider">Payment Details</h3>
                          <span class="text-xs text-on-surface-variant italic">(Optional)</span>
                        </div>
                        <p class="text-xs text-on-surface-variant mb-6">
                          You can complete payment now or skip and pay later. Your account will be set up regardless.
                        </p>
                        <div class="space-y-4">
                          <div>
                            <label class="form-label">Card Number</label>
                            <input type="text" formControlName="cardNumber" (input)="formatCardNumber($event)" maxlength="19"
                              class="form-input" [class.border-error-500]="isPaymentFieldInvalid('cardNumber')"
                              placeholder="1234 5678 9012 3456" />
                              @if (isPaymentFieldInvalid('cardNumber')) {
                                <p class="form-error">
                                  {{ getErrorMessage('cardNumber') }}
                                </p>
                              }
                            </div>
                            <div>
                              <label class="form-label">Card Holder Name</label>
                              <input type="text" formControlName="cardHolder" class="form-input"
                                [class.border-error-500]="isPaymentFieldInvalid('cardHolder')" placeholder="John Doe" />
                                @if (isPaymentFieldInvalid('cardHolder')) {
                                  <p class="form-error">
                                    {{ getErrorMessage('cardHolder') }}
                                  </p>
                                }
                              </div>
                              <div class="grid grid-cols-2 gap-4">
                                <div>
                                  <label class="form-label">Expiry Date</label>
                                  <input type="text" formControlName="expiryDate" (input)="formatExpiryDate($event)" maxlength="5"
                                    class="form-input" [class.border-error-500]="isPaymentFieldInvalid('expiryDate')"
                                    placeholder="MM/YY" />
                                    @if (isPaymentFieldInvalid('expiryDate')) {
                                      <p class="form-error">
                                        {{ getErrorMessage('expiryDate') }}
                                      </p>
                                    }
                                  </div>
                                  <div>
                                    <label class="form-label">CVV</label>
                                    <input type="text" formControlName="cvv" maxlength="4" class="form-input"
                                      [class.border-error-500]="isPaymentFieldInvalid('cvv')" placeholder="123" />
                                      @if (isPaymentFieldInvalid('cvv')) {
                                        <p class="form-error">
                                          {{ getErrorMessage('cvv') }}
                                        </p>
                                      }
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <!-- Submit Buttons -->
                              <div class="space-y-3">
                                <div class="flex gap-4">
                                  <button type="button" (click)="changePackage()"
                                    class="flex-1 py-3 px-6 bg-surface-variant text-on-surface rounded-lg font-semibold hover:bg-border transition-all border border-border">
                                    Back
                                  </button>
                                  <button type="submit"
                                    [disabled]="paymentForm.get('email')?.invalid || paymentForm.get('phone')?.invalid || paymentForm.get('organizationName')?.invalid || paymentForm.get('password')?.invalid || paymentForm.get('confirmPassword')?.invalid || paymentForm.hasError('passwordMismatch') || isProcessingPayment || isSubmitting"
                                    class="flex-1 py-3 px-6 bg-primary-600 text-white rounded-lg font-semibold hover:bg-primary-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md shadow-primary-950/20">
                                    @if (!isProcessingPayment && !isSubmitting) {
                                      <span>
                                        @if (hasPaymentInfo()) {
                                          <span>Complete Payment</span>
                                        }
                                        @if (!hasPaymentInfo()) {
                                          <span>Submit Registration</span>
                                        }
                                      </span>
                                    }
                                    @if (isProcessingPayment || isSubmitting) {
                                      <span class="flex items-center justify-center">
                                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                          <path class="opacity-75" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                          </path>
                                        </svg>
                                        @if (isProcessingPayment) {
                                          <span>Processing Payment...</span>
                                        }
                                        @if (isSubmitting) {
                                          <span>Submitting...</span>
                                        }
                                      </span>
                                    }
                                  </button>
                                </div>
                                <button type="button" (click)="skipPayment()"
                                  [disabled]="paymentForm.get('email')?.invalid || paymentForm.get('phone')?.invalid || paymentForm.get('organizationName')?.invalid || paymentForm.get('password')?.invalid || paymentForm.get('confirmPassword')?.invalid || paymentForm.hasError('passwordMismatch') || isProcessingPayment || isSubmitting"
                                  class="w-full py-3 px-6 bg-surface border-2 border-border text-on-surface rounded-lg font-semibold hover:bg-surface-variant transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                  Skip Payment & Submit
                                </button>
                              </div>
                            </form>
                          </div>
                        </div>
                      }

                      <!-- Welcome Message Section -->
                      @if (showWelcomeMessage) {
                        <div id="welcome-section" class="max-w-3xl mx-auto">
                          <div
                            class="bg-gradient-to-br from-primary-500/10 to-success-500/10 rounded-2xl shadow-strong p-8 md:p-12 text-center border border-primary-500/20">
                            <div class="mb-6">
                              <div
                                class="w-20 h-20 bg-success-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg shadow-success-500/20">
                                <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                              </div>
                            </div>
                            <h2 class="text-4xl font-bold text-on-surface mb-4">Welcome to MediPos!</h2>
                            <p class="text-xl text-on-surface mb-2">
                              Thank you for choosing <strong>{{ selectedPackage?.name }}</strong>
                            </p>
                            @if (paymentCompleted) {
                              <p class="text-lg text-on-surface-variant mb-4">
                                Your payment has been processed successfully. You're all set to start managing prescriptions!
                              </p>
                            }
                            @if (!paymentCompleted) {
                              <p class="text-lg text-on-surface-variant mb-4">
                                Your registration has been submitted successfully! You can complete payment later from your account dashboard.
                              </p>
                            }
                            @if (!paymentCompleted) {
                              <div class="mb-8 p-4 bg-warning-500/10 border border-warning-500/20 rounded-lg">
                                <p class="text-sm text-warning-600 dark:text-warning-400">
                                  <strong>Note:</strong> Your account will be activated once payment is completed. You can make the payment
                                  anytime from your account settings.
                                </p>
                              </div>
                            }
                            <div class="bg-surface rounded-xl p-6 mb-8 text-left border border-border shadow-soft">
                              <h3 class="text-lg font-semibold text-on-surface mb-4">What's Next?</h3>
                              <ul class="space-y-4">
                                <li class="flex items-start">
                                  <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                  </svg>
                                  <span class="text-on-surface-variant text-balance">Check your email (<strong>{{
                                  paymentForm.get('email')?.value }}</strong>) for account setup instructions</span>
                                </li>
                                <li class="flex items-start">
                                  <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                  </svg>
                                  <span class="text-on-surface-variant">Log in to your account to access all features</span>
                                </li>
                                <li class="flex items-start">
                                  <svg class="w-5 h-5 text-primary-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                  </svg>
                                  <span class="text-on-surface-variant">Explore our comprehensive documentation and tutorials</span>
                                </li>
                              </ul>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                              <a routerLink="/auth/login"
                                class="px-8 py-3 bg-primary-600 text-white rounded-lg font-semibold hover:bg-primary-700 transition-all shadow-md shadow-primary-500/20">
                                Go to Login
                              </a>
                              <button
                                (click)="selectedPackage = null; showPaymentForm = false; showWelcomeMessage = false; paymentForm.reset();"
                                class="px-8 py-3 bg-surface border-2 border-primary-600 text-primary-600 rounded-lg font-semibold hover:bg-surface-variant transition-all">
                                Back to Packages
                              </button>
                            </div>
                          </div>
                        </div>
                      }
                    </div>
                  </div>